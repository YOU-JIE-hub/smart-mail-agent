.........s.....ss..............s.ssss...                                 [100%]
=============================== warnings summary ===============================
.venv/lib/python3.10/site-packages/pydantic/_internal/_config.py:323
  /home/youjie/projects/smart-mail-agent/.venv/lib/python3.10/site-packages/pydantic/_internal/_config.py:323: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)

.venv/lib/python3.10/site-packages/pydantic/_internal/_config.py:373
  /home/youjie/projects/smart-mail-agent/.venv/lib/python3.10/site-packages/pydantic/_internal/_config.py:373: UserWarning: Valid config keys have changed in V2:
  * 'allow_population_by_field_name' has been renamed to 'validate_by_name'
    warnings.warn(message, UserWarning)

tests/unit/test_contracts.py::test_request_normalization_defaults
  /home/youjie/projects/smart-mail-agent/tests/unit/test_contracts.py:9: PydanticDeprecatedSince20: The `dict` method is deprecated; use `model_dump` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
    req = normalize_request(raw).dict(by_alias=True)

tests/unit/test_contracts.py::test_result_normalization_prefix_and_fields
  /home/youjie/projects/smart-mail-agent/tests/unit/test_contracts.py:23: PydanticDeprecatedSince20: The `dict` method is deprecated; use `model_dump` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
    res = normalize_result(raw).dict()

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.10.12-final-0 _______________

Name                                                                  Stmts   Miss Branch BrPart  Cover   Missing
-----------------------------------------------------------------------------------------------------------------
src/smart_mail_agent/__init__.py                                          3      0      0      0 100.0%
src/smart_mail_agent/__main__.py                                          3      3      2      0   0.0%   3-6
src/smart_mail_agent/__version__.py                                       3      0      0      0 100.0%
src/smart_mail_agent/actions/__init__.py                                  1      0      0      0 100.0%
src/smart_mail_agent/actions/complaint.py                                38     38     10      0   0.0%   1-88
src/smart_mail_agent/actions/sales_inquiry.py                           112    112     30      0   0.0%   1-224
src/smart_mail_agent/cli_spamcheck.py                                     3      3      2      0   0.0%   8-11
src/smart_mail_agent/core/classifier.py                                  80     57     14      1  25.5%   45-52, 73-86, 92, 96, 100-134, 143-175, 179
src/smart_mail_agent/features/__init__.py                                 1      0      0      0 100.0%
src/smart_mail_agent/features/apply_diff.py                              43     43     12      0   0.0%   2-103
src/smart_mail_agent/features/leads_logger.py                            27     27      0      0   0.0%   2-85
src/smart_mail_agent/features/modules_legacy/__init__.py                  2      2      0      0   0.0%   1-3
src/smart_mail_agent/features/quote_logger.py                            36     36      0      0   0.0%   1-109
src/smart_mail_agent/features/sales_notifier.py                           6      6      0      0   0.0%   1-22
src/smart_mail_agent/features/spam/__init__.py                            6      0      4      0 100.0%
src/smart_mail_agent/features/spam/feature_extractor.py                   6      6      4      0   0.0%   1-10
src/smart_mail_agent/features/spam/inference_classifier.py              102     83     10      1  17.9%   32-46, 51-57, 62-69, 74-85, 90-95, 108-117, 121-167, 171
src/smart_mail_agent/features/spam/ml_spam_classifier.py                  6      6      4      0   0.0%   1-10
src/smart_mail_agent/features/spam/pipeline.py                            6      6      4      0   0.0%   1-10
src/smart_mail_agent/features/spam/rule_filter.py                         6      6      4      0   0.0%   1-10
src/smart_mail_agent/features/spam/rules.py                               6      6      4      0   0.0%   1-10
src/smart_mail_agent/features/spam/spam_filter_orchestrator.py            6      6      4      0   0.0%   1-10
src/smart_mail_agent/ingestion/email_processor.py                        93     59     12      2  34.3%   28-31, 41-42, 46-144, 150, 155-156, 176-182
src/smart_mail_agent/ingestion/integrations/send_with_attachment.py      86     62     20      1  23.6%   34-39, 44-50, 61-108, 113-131, 135
src/smart_mail_agent/observability/log_writer.py                         38     25      4      2  35.7%   13->19, 25-40, 68-102, 107-128
src/smart_mail_agent/patches/__init__.py                                  1      0      0      0 100.0%
src/smart_mail_agent/patches/handle_router_patch.py                      21     21      6      0   0.0%   1-36
src/smart_mail_agent/patches/handle_safe_patch.py                        40     24     16      0  35.7%   18-19, 25-26, 30-36, 40-52
src/smart_mail_agent/policy_engine.py                                    56     15     22      2  70.5%   11-17, 21-23, 37-39, 67-68, 73->72
src/smart_mail_agent/routing/__init__.py                                  2      0      0      0 100.0%
src/smart_mail_agent/routing/action_handler.py                          139    108     14      1  20.9%   23-27, 31-66, 89, 99, 106-120, 124-138, 149-155, 165-171, 181-187, 197-201, 211-215, 235, 239-249, 259-261, 265-291, 295
src/smart_mail_agent/routing/run_action_handler.py                      128    128     30      0   0.0%   1-203
src/smart_mail_agent/sma_types.py                                        68     11     12      4  76.2%   10-14, 23, 63-66, 74-77, 88->91, 92->95
src/smart_mail_agent/spam/__init__.py                                     1      0      0      0 100.0%
src/smart_mail_agent/spam/feature_extractor.py                           10     10      0      0   0.0%   2-38
src/smart_mail_agent/spam/ml_spam_classifier.py                          32     32      2      0   0.0%   2-76
src/smart_mail_agent/spam/orchestrator_offline.py                       178     78     68     10  48.8%   18->23, 37, 45, 49-59, 64-121, 129-143, 162-163, 247-249, 255->259, 271, 291, 296
src/smart_mail_agent/spam/pipeline.py                                    41     30      8      1  24.5%   17-41, 51-55, 59-62, 66
src/smart_mail_agent/spam/rule_filter.py                                 28     28     12      0   0.0%   2-87
src/smart_mail_agent/spam/rules.py                                      113     26     46     10  71.1%   43, 64->67, 73, 84, 106-142, 176->174, 184-185, 189-190, 194, 198->197, 219-222
src/smart_mail_agent/spam/spam_filter_orchestrator.py                    29     18     10      0  28.2%   39-92, 107, 112, 117, 122
src/smart_mail_agent/spam/spam_llm_filter.py                             27     27      2      0   0.0%   1-60
src/smart_mail_agent/utils/__init__.py                                    2      0      0      0 100.0%
src/smart_mail_agent/utils/config.py                                     12     12      0      0   0.0%   1-17
src/smart_mail_agent/utils/db_tools.py                                   39     39      6      0   0.0%   2-93
src/smart_mail_agent/utils/env.py                                        12     12      6      0   0.0%   1-17
src/smart_mail_agent/utils/errors.py                                      7      7      0      0   0.0%   1-19
src/smart_mail_agent/utils/font_check.py                                 16     16      4      0   0.0%   1-23
src/smart_mail_agent/utils/fonts.py                                      14     14      6      0   0.0%   2-21
src/smart_mail_agent/utils/imap_folder_detector.py                       46     46     16      0   0.0%   3-76
src/smart_mail_agent/utils/imap_login.py                                 15     15      2      0   0.0%   1-24
src/smart_mail_agent/utils/jsonlog.py                                    58     58     12      0   0.0%   1-91
src/smart_mail_agent/utils/log_writer.py                                  7      0      0      0 100.0%
src/smart_mail_agent/utils/logger.py                                     18      5      4      1  63.6%   14->16, 20-24
src/smart_mail_agent/utils/logging_setup.py                              28     28      8      0   0.0%   1-46
src/smart_mail_agent/utils/mailer.py                                     51     39      8      0  20.3%   16, 20-31, 41-70
src/smart_mail_agent/utils/pdf_generator.py                              51     51      6      0   0.0%   1-94
src/smart_mail_agent/utils/pdf_safe.py                                  129     21     42      6  84.2%   25-26, 32-36, 46-48, 51-52, 98-99, 106-108, 119, 121, 127-128
src/smart_mail_agent/utils/priority_evaluator.py                         27     27      8      0   0.0%   2-85
src/smart_mail_agent/utils/rag_reply.py                                  41     41      6      0   0.0%   1-89
src/smart_mail_agent/utils/templater.py                                  24     24     12      0   0.0%   1-50
src/smart_mail_agent/utils/tracing.py                                    12     12      0      0   0.0%   1-15
src/smart_mail_agent/utils/validators.py                                 37     37     16      0   0.0%   1-51
-----------------------------------------------------------------------------------------------------------------
TOTAL                                                                  2279   1652    554     42  26.3%
Coverage XML written to file coverage.xml
