ROOT: /home/youjie/projects/smart-mail-agent
├── .github/
│   ├── ISSUE_TEMPLATE/
│   │   ├── bug_report.md
│   │   ├── bug_report.yml
│   │   ├── feature_request.md
│   │   └── feature_request.yml
│   ├── PULL_REQUEST_TEMPLATE/
│   │   └── pull_request_template.md
│   ├── workflows/
│   │   ├── ci.yml
│   │   ├── codeql.yml
│   │   ├── lint.yml
│   │   ├── release-drafter.yml
│   │   ├── smtp_integration.yml
│   │   ├── tests.yml
│   │   └── typecheck.yml
│   ├── CODEOWNERS
│   ├── dependabot.yml
│   └── release-drafter.yml
├── .local-logs/
│   ├── test_action_result_contracts.py.log
│   └── test_actions_matrix_ext.py.log
├── assets/
│   └── fonts/
├── badges/
│   └── coverage.svg
├── bin/
│   ├── fmt
│   ├── lint
│   ├── run_ai_rpa
│   ├── sma
│   ├── sma-housekeeping
│   └── smarun
├── configs/
│   ├── samples/
│   │   ├── policy.yaml
│   │   └── spam_rules.yaml
│   ├── ai_rpa_config.yaml
│   └── default.yml
├── data/
│   ├── complaints/
│   │   └── log.csv
│   ├── db/
│   ├── leads/
│   │   └── leads.csv
│   ├── output/
│   │   ├── matrix/
│   │   │   └── matrix_summary.json
│   │   ├── .gitkeep
│   │   ├── attachment_20250819_000030.pdf
│   │   ├── attachment_20250819_000033.txt
│   │   ├── attachment_20250819_000034.pdf
│   │   ├── attachment_20250819_003243.pdf
│   │   ├── attachment_20250819_003245.txt
│   │   ├── attachment_20250819_003246.pdf
│   │   ├── attachment_20250819_143846.pdf
│   │   ├── attachment_20250819_143848.txt
│   │   ├── attachment_20250819_215631.pdf
│   │   ├── attachment_20250819_215632.txt
│   │   ├── attachment_20250819_223113.pdf
│   │   ├── attachment_20250819_223424.txt
│   │   ├── attachment_20250819_234014.pdf
│   │   ├── attachment_20250819_234016.txt
│   │   ├── attachment_20250820_001041.pdf
│   │   ├── attachment_20250820_001042.txt
│   │   ├── attachment_20250820_001046.pdf
│   │   ├── attachment_20250820_001047.txt
│   │   ├── attachment_20250820_001325.pdf
│   │   ├── attachment_20250820_001326.txt
│   │   ├── attachment_20250820_011503.pdf
│   │   ├── attachment_20250820_011503.txt
│   │   ├── attachment_20250820_143917.pdf
│   │   ├── attachment_20250820_143917.txt
│   │   ├── attachment_20250820_143928.pdf
│   │   ├── attachment_20250820_143929.txt
│   │   ├── attachment_20250820_143930.pdf
│   │   ├── attachment_20250820_143930.txt
│   │   ├── attachment_20250820_144643.pdf
│   │   ├── attachment_20250820_144644.txt
│   │   ├── attachment_20250820_144645.pdf
│   │   ├── attachment_20250820_144647.txt
│   │   ├── attachment_20250820_145345.pdf
│   │   ├── attachment_20250820_145346.txt
│   │   ├── attachment_20250820_145852.pdf
│   │   ├── attachment_20250820_150500.pdf
│   │   ├── attachment_20250820_150753.txt
│   │   ├── attachment_20250820_164412.pdf
│   │   ├── attachment_20250821_013231.pdf
│   │   ├── attachment_20250821_013955.pdf
│   │   ├── attachment_20250821_014354.pdf
│   │   ├── attachment_20250821_020412.pdf
│   │   ├── attachment_20250821_022115.pdf
│   │   ├── attachment_20250821_024408.pdf
│   │   ├── attachment_20250821_032921.pdf
│   │   ├── attachment_20250821_035001.pdf
│   │   ├── attachment_20250821_041640.pdf
│   │   ├── attachment_20250821_041940.pdf
│   │   ├── attachment_20250821_041954.pdf
│   │   ├── attachment_20250821_042646.pdf
│   │   ├── attachment_20250821_043827.pdf
│   │   ├── attachment_20250821_052841.pdf
│   │   ├── attachment_20250821_053346.pdf
│   │   ├── attachment_20250821_053555.pdf
│   │   ├── attachment_20250821_054248.pdf
│   │   ├── attachment_20250821_065849.pdf
│   │   ├── attachment_20250821_070119.pdf
│   │   ├── attachment_20250821_070327.pdf
│   │   ├── attachment_20250821_070550.pdf
│   │   ├── attachment_20250821_070719.pdf
│   │   ├── attachment_20250821_071104.pdf
│   │   ├── attachment_20250821_071336.pdf
│   │   ├── attachment_20250821_071507.pdf
│   │   ├── attachment_20250821_071711.pdf
│   │   ├── attachment_20250821_071921.pdf
│   │   ├── attachment_20250821_072155.pdf
│   │   ├── attachment_20250821_073145.pdf
│   │   ├── attachment_20250821_073535.pdf
│   │   ├── in_c.json
│   │   ├── in_overlimit.json
│   │   ├── in_sales.json
│   │   ├── in_whitelist.json
│   │   ├── out_c.json
│   │   ├── out_overlimit.json
│   │   ├── out_sales.json
│   │   └── out_whitelist.json
│   ├── tmp/
│   │   ├── pdf_generation_error_20250816T185042Z.txt
│   │   └── pdf_generation_error_20250816T185046Z.txt
│   └── quote_log.db
├── docs/
│   ├── ci/
│   │   └── pipeline.md
│   ├── guide/
│   │   ├── cli.md
│   │   └── tests.md
│   ├── architecture.md
│   ├── cli.md
│   └── index.md
├── examples/
│   └── legacy_lowcov/
│       ├── src/
│       │   ├── actions/
│       │   │   └── __init__.py
│       │   ├── modules/
│       │   │   └── leads_logger.py
│       │   ├── patches/
│       │   │   ├── handle_router_patch.py
│       │   │   └── handle_safe_patch.py
│       │   ├── smart_mail_agent/
│       │   │   ├── actions/
│       │   │   │   ├── complaint.py
│       │   │   │   └── sales_inquiry.py
│       │   │   ├── spam/
│       │   │   │   ├── feature_extractor.py
│       │   │   │   ├── ml_spam_classifier.py
│       │   │   │   ├── pipeline.py
│       │   │   │   ├── rule_filter.py
│       │   │   │   ├── rules.py
│       │   │   │   └── spam_llm_filter.py
│       │   │   ├── utils/
│       │   │   │   ├── config.py
│       │   │   │   ├── db_tools.py
│       │   │   │   ├── env.py
│       │   │   │   ├── errors.py
│       │   │   │   ├── font_check.py
│       │   │   │   ├── fonts.py
│       │   │   │   ├── imap_folder_detector.py
│       │   │   │   ├── imap_login.py
│       │   │   │   ├── jsonlog.py
│       │   │   │   ├── log_writer.py
│       │   │   │   ├── logging_setup.py
│       │   │   │   ├── pdf_generator.py
│       │   │   │   ├── pdf_safe.py
│       │   │   │   ├── priority_evaluator.py
│       │   │   │   ├── rag_reply.py
│       │   │   │   ├── templater.py
│       │   │   │   ├── tracing.py
│       │   │   │   └── validators.py
│       │   │   ├── __main__.py
│       │   │   └── cli_spamcheck.py
│       │   ├── spam/
│       │   │   ├── feature_extractor.py
│       │   │   ├── ml_spam_classifier.py
│       │   │   ├── rule_filter.py
│       │   │   └── rules.py
│       │   ├── utils/
│       │   │   └── jsonlog.py
│       │   ├── email_processor.py
│       │   ├── inference_classifier.py
│       │   ├── log_writer.py
│       │   ├── run_action_handler.py
│       │   ├── send_with_attachment.py
│       │   ├── support_ticket.py
│       │   └── train_classifier.py
│       └── README.md
├── modules/
│   ├── __init__.py
│   ├── apply_diff.py
│   ├── quotation.py
│   ├── quote_logger.py
│   └── sales_notifier.py
├── reports/
│   └── .gitkeep
├── scripts/
│   ├── __init__.py
│   ├── ci_status.sh
│   ├── cov_focus_modules.py
│   ├── demo_offline.sh
│   ├── housekeeping.sh
│   ├── online_check.py
│   ├── oss_snapshot.sh
│   ├── run_pipeline.sh
│   └── setup_env.sh
├── share/
│   ├── git_files.txt
│   ├── git_untracked.txt
│   ├── tree_depth2.txt
│   ├── tree_depth3.txt
│   └── tree_full.txt
├── site/
│   └── .gitkeep
├── src/
│   ├── ai_rpa/
│   │   ├── utils/
│   │   │   ├── config_loader.py
│   │   │   └── logger.py
│   │   ├── actions.py
│   │   ├── file_classifier.py
│   │   ├── main.py
│   │   ├── nlp.py
│   │   ├── ocr.py
│   │   └── scraper.py
│   ├── modules/
│   ├── patches/
│   │   ├── __init__.py
│   │   └── handle_safe_patch.py
│   ├── scripts/
│   │   ├── __init__.py
│   │   └── online_check.py
│   ├── smart_mail_agent/
│   │   ├── actions/
│   │   │   ├── __init__.py
│   │   │   ├── complaint.py
│   │   │   └── sales_inquiry.py
│   │   ├── cli/
│   │   │   ├── sma.py
│   │   │   ├── sma_run.py
│   │   │   └── sma_spamcheck.py
│   │   ├── core/
│   │   │   ├── utils/
│   │   │   │   ├── .keep
│   │   │   │   ├── __init__.py
│   │   │   │   ├── jsonlog.py
│   │   │   │   ├── logger.py
│   │   │   │   └── mailer.py
│   │   │   ├── classifier.py
│   │   │   ├── policy_engine.py
│   │   │   └── sma_types.py
│   │   ├── features/
│   │   │   ├── modules_legacy/
│   │   │   │   └── __init__.py
│   │   │   ├── sales/
│   │   │   │   └── quotation.py
│   │   │   ├── spam/
│   │   │   ├── support/
│   │   │   │   └── support_ticket.py
│   │   │   ├── __init__.py
│   │   │   ├── apply_diff.py
│   │   │   ├── leads_logger.py
│   │   │   ├── quote_logger.py
│   │   │   └── sales_notifier.py
│   │   ├── ingestion/
│   │   │   ├── integrations/
│   │   │   │   └── send_with_attachment.py
│   │   │   ├── email_processor.py
│   │   │   └── init_db.py
│   │   ├── observability/
│   │   │   ├── log_writer.py
│   │   │   ├── sitecustomize.py
│   │   │   ├── stats_collector.py
│   │   │   └── tracing.py
│   │   ├── patches/
│   │   │   ├── __init__.py
│   │   │   ├── handle_router_patch.py
│   │   │   └── handle_safe_patch.py
│   │   ├── routing/
│   │   │   ├── __init__.py
│   │   │   ├── action_handler.py
│   │   │   └── run_action_handler.py
│   │   ├── smart_mail_agent/
│   │   │   ├── spam/
│   │   │   ├── utils/
│   │   │   │   ├── __init__.py
│   │   │   │   └── pdf_safe.py
│   │   │   └── __init__.py
│   │   ├── spam/
│   │   │   ├── .keep
│   │   │   ├── __init__.py
│   │   │   ├── feature_extractor.py
│   │   │   ├── inference_classifier.py
│   │   │   ├── ml_spam_classifier.py
│   │   │   ├── offline_orchestrator.py
│   │   │   ├── orchestrator_offline.py
│   │   │   ├── pipeline.py
│   │   │   ├── rule_filter.py
│   │   │   ├── rules.py
│   │   │   ├── spam_filter_orchestrator.py
│   │   │   ├── spam_llm_filter.py
│   │   │   └── spam_rules.yaml
│   │   ├── trainers/
│   │   │   ├── train_bert_spam_classifier.py
│   │   │   └── train_classifier.py
│   │   ├── utils/
│   │   │   ├── __init__.py
│   │   │   ├── config.py
│   │   │   ├── db_tools.py
│   │   │   ├── env.py
│   │   │   ├── errors.py
│   │   │   ├── font_check.py
│   │   │   ├── fonts.py
│   │   │   ├── imap_folder_detector.py
│   │   │   ├── imap_login.py
│   │   │   ├── jsonlog.py
│   │   │   ├── log_writer.py
│   │   │   ├── logger.py
│   │   │   ├── logging_setup.py
│   │   │   ├── mailer.py
│   │   │   ├── pdf_generator.py
│   │   │   ├── pdf_safe.py
│   │   │   ├── priority_evaluator.py
│   │   │   ├── rag_reply.py
│   │   │   ├── templater.py
│   │   │   ├── tracing.py
│   │   │   └── validators.py
│   │   ├── __init__.py
│   │   ├── __main__.py
│   │   ├── __version__.py
│   │   ├── cli_spamcheck.py
│   │   ├── email_processor.py
│   │   ├── inference_classifier.py
│   │   ├── policy_engine.py
│   │   └── sma_types.py
│   ├── spam/
│   │   ├── __init__.py
│   │   └── spam_filter_orchestrator.py
│   ├── utils/
│   │   ├── __init__.py
│   │   ├── log_writer.py
│   │   ├── logger.py
│   │   ├── mailer.py
│   │   └── pdf_safe.py
│   ├── action_handler.py
│   ├── classifier.py
│   ├── email_processor.py
│   ├── inference_classifier.py
│   ├── run_action_handler.py
│   ├── send_with_attachment.py
│   └── stats_collector.py
├── tests/
│   ├── contracts/
│   │   ├── conftest.py
│   │   └── test_action_result_contracts.py
│   ├── e2e/
│   │   ├── conftest.py
│   │   ├── test_actions_matrix_ext.py
│   │   ├── test_cli_flags.py
│   │   ├── test_cli_scripts.py
│   │   ├── test_complaint_policy.py
│   │   ├── test_label_routing_offline.py
│   │   ├── test_new_intents.py
│   │   ├── test_offline_suite.py
│   │   ├── test_policy_expansion.py
│   │   ├── test_runner.py
│   │   ├── test_sales_and_complaint.py
│   │   ├── test_sales_inquiry_needs_summary.py
│   │   ├── test_send_quote_degrade.py
│   │   └── test_spam_pipeline.py
│   ├── integration/
│   │   ├── test_email_end_to_end_offline.py
│   │   └── test_online_send_paths.py
│   ├── internal_smoke/
│   │   └── test_import_all_internal.py
│   ├── online/
│   │   └── test_smtp_send.py
│   ├── policy/
│   │   ├── test_attachment_risks_extra.py
│   │   └── test_attachment_risks_matrix.py
│   ├── portfolio/
│   │   ├── test_email_processor_utils.py
│   │   ├── test_inference_classifier_fallback.py
│   │   ├── test_log_writer.py
│   │   ├── test_patches_router.py
│   │   ├── test_pdf_safe.py
│   │   ├── test_policy_engine_smoke.py
│   │   ├── test_quotation_module.py
│   │   ├── test_run_action_handler_cli_offline.py
│   │   ├── test_send_with_attachment_shim.py
│   │   ├── test_spam_cli_help.py
│   │   ├── test_spam_orchestrator_smoke.py
│   │   ├── test_spam_rules_scoring.py
│   │   └── test_support_ticket.py
│   ├── smoke/
│   │   ├── test_cli_help.py
│   │   └── test_log_writer_import.py
│   ├── spam/
│   │   ├── test_offline_orchestrator_contracts.py
│   │   ├── test_offline_orchestrator_e2e.py
│   │   ├── test_offline_orchestrator_model_variants.py
│   │   ├── test_offline_orchestrator_model_variants_extra.py
│   │   ├── test_offline_orchestrator_paths.py
│   │   ├── test_rule_model_tiebreak_offline.py
│   │   ├── test_rules.py
│   │   └── test_rules_offline_behaviors.py
│   ├── unit/
│   │   ├── test_ai_rpa_min.py
│   │   ├── test_classifier_rules_extra.py
│   │   ├── test_classifier_shapes_and_rules.py
│   │   ├── test_cli_orchestrator_offline.py
│   │   ├── test_cli_sma_version.py
│   │   ├── test_contracts.py
│   │   ├── test_cov_anchor_modules.py
│   │   ├── test_email_processor_order_extra.py
│   │   ├── test_email_processor_smoke.py
│   │   ├── test_handle_safe_patch_min.py
│   │   ├── test_html_link_ratio_edges_new.py
│   │   ├── test_html_link_ratio_more_edges.py
│   │   ├── test_i18n_keywords_nfkc.py
│   │   ├── test_i18n_nfkc_edges.py
│   │   ├── test_inference_classifier_errors.py
│   │   ├── test_log_writer_db_smoke.py
│   │   ├── test_logger_utils_smoke.py
│   │   ├── test_modules_smoke_imports.py
│   │   ├── test_pdf_generator_smoke.py
│   │   ├── test_pdf_safe_extra.py
│   │   ├── test_pdf_safe_more_ascii.py
│   │   ├── test_pdf_safe_security_more.py
│   │   ├── test_policy_engine.py
│   │   ├── test_policy_minimal.py
│   │   ├── test_quotation_big_attachment_edges.py
│   │   ├── test_quotation_branch_matrix.py
│   │   ├── test_quotation_branches.py
│   │   ├── test_quotation_branches_extra.py
│   │   ├── test_quotation_cli.py
│   │   ├── test_quotation_cli_only.py
│   │   ├── test_quotation_core.py
│   │   ├── test_quotation_cov_extra.py
│   │   ├── test_quotation_cov_extra2.py
│   │   ├── test_quotation_full_coverage.py
│   │   ├── test_quotation_more_edges.py
│   │   ├── test_quotation_needs_manual_more.py
│   │   ├── test_quotation_pdf_paths.py
│   │   ├── test_quotation_pdf_smoke.py
│   │   ├── test_rules_conf_suffix_reasons.py
│   │   ├── test_send_with_attachment_smoke.py
│   │   ├── test_sma_types_normalize_extra.py
│   │   ├── test_spam_pipeline_smoke.py
│   │   ├── test_spam_rules_min.py
│   │   ├── test_spam_stack.py
│   │   ├── test_tasks_minimal.py
│   │   ├── test_templater_smoke.py
│   │   └── test_utils_pdf_safe_top.py
│   ├── .keep
│   ├── conftest.py
│   ├── test_action_handler.py
│   ├── test_apply_diff.py
│   ├── test_classifier.py
│   ├── test_cli_spamcheck.py
│   ├── test_init_db.py
│   ├── test_init_emails_log_db.py
│   ├── test_init_processed_mails_db.py
│   ├── test_init_tickets_db.py
│   ├── test_mailer.py
│   ├── test_mailer_online.py
│   ├── test_quotation.py
│   ├── test_quote_logger.py
│   ├── test_sales_notifier.py
│   ├── test_send_with_attachment.py
│   ├── test_spam_filter.py
│   └── test_stats_collector.py
├── tools/
│   └── run_actions_matrix.py
├── .coverage
├── .editorconfig
├── .env.example
├── .env.smtp.example
├── .gitattributes
├── .gitignore
├── .pre-commit-config.yaml
├── .pre-commit-config.yaml.bak.20250818T032817
├── .review_cursor
├── .ruff.toml
├── .ruff.toml.bak.20250818T105514
├── assert
├── CONTRIBUTING.md
├── coverage.xml
├── init_db.py
├── LICENSE
├── Makefile
├── mkdocs.yml
├── online_check_shadow_root.py
├── pyproject.toml
├── pytest.ini
├── quote.pdf
├── quote_pdf.pdf
├── README.md
├── repo_files_after_clean.txt
├── requirements.txt
├── SECURITY.md
├── sitecustomize.py
└── tox.ini
